(()=>{var e={};e.id=416,e.ids=[416],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4576:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var r=s(482),a=s(9108),i=s(2563),n=s.n(i),o=s(8300),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let d=["",{children:["edit",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,283)),"C:\\Users\\ณวิธบุญยะรัตน์\\Desktop\\Next.js\\4.Prasobpai\\app\\edit\\[id]\\page.js"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,311)),"C:\\Users\\ณวิธบุญยะรัตน์\\Desktop\\Next.js\\4.Prasobpai\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\ณวิธบุญยะรัตน์\\Desktop\\Next.js\\4.Prasobpai\\app\\edit\\[id]\\page.js"],u="/edit/[id]/page",p={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/edit/[id]/page",pathname:"/edit/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5868:(e,t,s)=>{Promise.resolve().then(s.bind(s,8147))},8147:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var r=s(5344),a=s(3729),i=s(8428),n=s(9873),o=s(8987),l=s(8013);let d=(0,s(4285).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);var c=s(5421),u=s(2594),p=s(7853),x=s(6506),m=s(6983),f=s(8331);function b({params:e}){let t=(0,i.useRouter)(),{id:s}=e,[b,h]=(0,a.useState)(!0),[g,y]=(0,a.useState)(!1),[j,v]=(0,a.useState)({title:"",category:"มรสุมชีวิต",severity:5,content:""}),[_,w]=(0,a.useState)(null),N={crisis:"มรสุมชีวิต",daily:"ภัยรายวัน",funny:"ขำแห้ง",guide:"คู่มือรอด"},P={มรสุมชีวิต:"crisis",ภัยรายวัน:"daily",ขำแห้ง:"funny",คู่มือรอด:"guide"};(0,a.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await u.supabase.auth.getUser();if(!e){t.push("/login");return}w(e.id);let{data:r,error:a}=await u.supabase.from("stories").select("*").eq("id",s).single();if(a)throw a;let{data:i}=await u.supabase.from("profiles").select("role").eq("id",e.id).single(),n=r.user_id===e.id,o=i?.role==="admin";if(!n&&!o){p.default.fire("Error","คุณไม่มีสิทธิ์แก้ไขโพสต์นี้","error"),t.push("/");return}v({title:r.title,category:N[r.category]||"มรสุมชีวิต",severity:r.severity_level,content:r.content})}catch(e){console.error("Error fetching story:",e),p.default.fire("Error","ไม่พบโพสต์ที่ต้องการแก้ไข","error"),t.push("/")}finally{h(!1)}})()},[s,t]);let k=e=>{let{name:t,value:s}=e.target;v(e=>({...e,[t]:s}))},q=async e=>{e.preventDefault(),y(!0);let r=P[j.category];try{let{error:e}=await u.supabase.from("stories").update({title:j.title,category:r,severity_level:parseInt(j.severity),content:j.content}).eq("id",s);if(e)throw e;await p.default.fire({title:"บันทึกสำเร็จ!",text:"แก้ไขเรื่องราวเรียบร้อยแล้ว",icon:"success",confirmButtonText:"ตกลง",confirmButtonColor:"#0f172a"}),t.push("/"),t.refresh()}catch(e){console.error("Error updating story:",e),p.default.fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error",confirmButtonText:"ตกลง",confirmButtonColor:"#ef4444"})}finally{y(!1)}};return b?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fffbf0]",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-900"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-[#fffbf0] font-sans selection:bg-amber-200 selection:text-slate-900",children:[r.jsx(n.default,{}),(0,r.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8 md:py-12 mt-20 md:mt-0 pb-24 md:pb-0",children:[(0,r.jsxs)(x.default,{href:"/",className:"inline-flex items-center gap-2 text-slate-500 hover:text-slate-900 font-bold mb-4",children:[r.jsx(l.Z,{size:20})," กลับหน้าแรก"]}),(0,r.jsxs)("div",{className:"bg-white p-6 md:p-8 rounded-xl border-4 border-slate-900 shadow-[4px_4px_0px_0px_rgba(251,191,36,1)] relative",children:[(0,r.jsxs)("h2",{className:"text-2xl font-black text-slate-900 mb-2 flex items-center gap-2",children:[r.jsx(d,{className:"text-amber-500"})," แก้ไขเรื่องราว"]}),(0,r.jsxs)("form",{className:"space-y-4 mt-6",onSubmit:q,children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"หัวข้อเรื่อง"}),r.jsx("input",{type:"text",name:"title",value:j.title,onChange:k,className:"w-full p-3 border-2 border-slate-300 rounded-lg focus:border-slate-900 focus:outline-none bg-slate-50 text-sm",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"หมวดหมู่"}),(0,r.jsxs)("select",{name:"category",value:j.category,onChange:k,className:"w-full p-3 border-2 border-slate-300 rounded-lg focus:border-slate-900 focus:outline-none bg-slate-50 text-sm",children:[r.jsx("option",{children:"มรสุมชีวิต"}),r.jsx("option",{children:"ภัยรายวัน"}),r.jsx("option",{children:"ขำแห้ง"}),r.jsx("option",{children:"คู่มือรอด"})]})]}),r.jsx("div",{children:r.jsx(m.Z,{value:j.severity,onChange:k})})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"เล่าเหตุการณ์"}),r.jsx(f.Z,{content:j.content,onChange:e=>v(t=>({...t,content:e})),userId:_})]}),r.jsx("button",{type:"submit",disabled:g,className:"w-full bg-slate-900 text-amber-400 font-bold py-3 rounded-lg border-2 border-transparent hover:border-amber-400 shadow-lg transform active:scale-95 transition-transform disabled:opacity-50 flex justify-center items-center gap-2",children:g?"กำลังบันทึก...":(0,r.jsxs)(r.Fragment,{children:[r.jsx(c.Z,{size:20})," บันทึกการแก้ไข"]})})]})]})]}),r.jsx(o.Z,{})]})}},283:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>n});let r=(0,s(6843).createProxy)(String.raw`C:\Users\ณวิธบุญยะรัตน์\Desktop\Next.js\4.Prasobpai\app\edit\[id]\page.js`),{__esModule:a,$$typeof:i}=r,n=r.default},8013:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(4285).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5421:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(4285).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,901,727,567,130,154,843],()=>s(4576));module.exports=r})();