(()=>{var e={};e.id=159,e.ids=[159],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1824:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>o.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d});var s=a(482),r=a(9108),l=a(2563),o=a.n(l),i=a(8300),n={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>i[e]);a.d(t,n);let d=["",{children:["profile",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,2803)),"C:\\Users\\ณวิธบุญยะรัตน์\\Desktop\\Next.js\\4.Prasobpai\\app\\profile\\edit\\page.js"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,311)),"C:\\Users\\ณวิธบุญยะรัตน์\\Desktop\\Next.js\\4.Prasobpai\\app\\layout.js"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9361,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\ณวิธบุญยะรัตน์\\Desktop\\Next.js\\4.Prasobpai\\app\\profile\\edit\\page.js"],u="/profile/edit/page",p={require:a,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/profile/edit/page",pathname:"/profile/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4104:(e,t,a)=>{Promise.resolve().then(a.bind(a,5311))},5311:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var s=a(5344),r=a(3729),l=a(8428),o=a(2594),i=a(9873),n=a(8987),d=a(7853),c=a(2473),u=a(4285);let p=(0,u.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),x=(0,u.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var m=a(5421);function f(){let e=(0,l.useRouter)(),[t,a]=(0,r.useState)(!0),[u,f]=(0,r.useState)(!1),[h,b]=(0,r.useState)(null),[g,v]=(0,r.useState)(""),[j,y]=(0,r.useState)(""),[w,N]=(0,r.useState)(""),[_,k]=(0,r.useState)(""),[P,q]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{let{data:{user:t}}=await o.supabase.auth.getUser();if(!t){e.push("/login");return}b(t);let{data:a,error:s}=await o.supabase.from("profiles").select("*").eq("id",t.id).single();s&&"PGRST116"!==s.code&&console.error("Error fetching profile:",s),a?(v(a.display_name||t.user_metadata?.username||""),y(a.avatar_url||t.user_metadata?.avatar_url||"")):(v(t.user_metadata?.username||""),y(t.user_metadata?.avatar_url||""))}catch(e){console.error("Error:",e)}finally{a(!1)}})()},[e]);let M=async e=>{try{if(q(!0),!e.target.files||0===e.target.files.length)throw Error("กรุณาเลือกไฟล์ภาพที่ต้องการอัปโหลด");let t=e.target.files[0],a=t.name.split(".").pop(),s=`${Math.random()}.${a}`,r=`${h.id}/${s}`,{error:l}=await o.supabase.storage.from("avatars").upload(r,t);if(l)throw l;let{data:i}=o.supabase.storage.from("avatars").getPublicUrl(r);y(i.publicUrl)}catch(e){d.default.fire("อัปโหลดไม่สำเร็จ",e.message,"error")}finally{q(!1)}},E=async t=>{t.preventDefault(),f(!0);try{let t={id:h.id,display_name:g,avatar_url:j,updated_at:new Date},{error:a}=await o.supabase.from("profiles").upsert(t);if(a)throw a;if(await o.supabase.auth.updateUser({data:{username:g,avatar_url:j}}),w){if(w!==_)throw Error("รหัสผ่านไม่ตรงกัน");if(w.length<6)throw Error("รหัสผ่านต้องมีความยาวอย่างน้อย 6 ตัวอักษร");let{error:e}=await o.supabase.auth.updateUser({password:w});if(e)throw e}await d.default.fire({title:"บันทึกสำเร็จ!",text:"ข้อมูลโปรไฟล์ได้รับการอัปเดตแล้ว",icon:"success",confirmButtonText:"ตกลง",confirmButtonColor:"#0f172a"}),N(""),k(""),S(!1),e.refresh()}catch(e){console.error("Error updating profile:",e),d.default.fire({title:"บันทึกไม่สำเร็จ",text:"เกิดข้อผิดพลาด กรุณาลองใหม่",icon:"error",confirmButtonText:"ตกลง"})}finally{f(!1)}};return t?s.jsx("div",{className:"min-h-screen bg-[#fffbf0] flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-900"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-[#fffbf0] font-sans selection:bg-amber-200 selection:text-slate-900 flex flex-col",children:[s.jsx(i.default,{}),s.jsx("main",{className:"flex-grow pt-24 pb-12 px-4",children:s.jsx("div",{className:"max-w-xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl border-4 border-slate-900 shadow-[8px_8px_0px_0px_rgba(251,191,36,1)] p-6 md:p-8",children:[(0,s.jsxs)("h1",{className:"text-2xl font-black text-slate-900 mb-6 flex items-center gap-2",children:[s.jsx(c.Z,{className:"text-amber-500",size:32})," แก้ไขข้อมูลส่วนตัว"]}),(0,s.jsxs)("form",{onSubmit:E,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsxs)("div",{className:"relative group",children:[s.jsx("div",{className:"w-32 h-32 rounded-full border-4 border-slate-900 overflow-hidden bg-slate-100",children:s.jsx("img",{src:j||"https://api.dicebear.com/7.x/avataaars/svg?seed=default",alt:"Avatar",className:"w-full h-full object-cover"})}),s.jsx("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 bg-slate-900 text-white p-2 rounded-full hover:bg-amber-500 transition-colors shadow-lg cursor-pointer",title:"อัปโหลดรูปภาพ",children:s.jsx(p,{size:16})}),s.jsx("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:M,className:"hidden",disabled:P})]}),s.jsx("div",{className:"flex gap-2",children:(0,s.jsxs)("button",{type:"button",onClick:()=>{let e=Math.random().toString(36).substring(7);y(`https://api.dicebear.com/7.x/avataaars/svg?seed=${e}`)},className:"text-xs font-bold text-slate-500 hover:text-amber-600 flex items-center gap-1 bg-slate-100 px-3 py-1.5 rounded-full",children:[s.jsx(x,{size:12})," สุ่มรูปการ์ตูน"]})}),P&&s.jsx("p",{className:"text-xs text-amber-500 font-bold animate-pulse",children:"กำลังอัปโหลด..."})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"ชื่อที่ใช้แสดง (Display Name)"}),s.jsx("input",{type:"text",value:g,onChange:e=>v(e.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-slate-900 focus:outline-none bg-slate-50 font-medium",placeholder:"ใส่ชื่อเท่ๆ ของคุณ",maxLength:20,required:!0}),(0,s.jsxs)("p",{className:"text-xs text-slate-400 mt-1 text-right",children:[g.length,"/20"]})]}),(0,s.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>S(!C),className:"flex items-center justify-between w-full text-sm font-bold text-slate-700",children:[s.jsx("span",{children:"เปลี่ยนรหัสผ่าน"}),s.jsx("span",{className:`text-xl transition-transform ${C?"rotate-45":""}`,children:"+"})]}),C&&(0,s.jsxs)("div",{className:"mt-4 space-y-3 animate-slide-down",children:[s.jsx("div",{children:s.jsx("input",{type:"password",value:w,onChange:e=>N(e.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-slate-900 focus:outline-none bg-white font-medium",placeholder:"รหัสผ่านใหม่",minLength:6})}),s.jsx("div",{children:s.jsx("input",{type:"password",value:_,onChange:e=>k(e.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-slate-900 focus:outline-none bg-white font-medium",placeholder:"ยืนยันรหัสผ่านใหม่",minLength:6})}),s.jsx("p",{className:"text-xs text-slate-500",children:"ปล่อยว่างไว้หากไม่ต้องการเปลี่ยนรหัสผ่าน"})]})]}),s.jsx("hr",{className:"border-slate-100"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[s.jsx("button",{type:"button",onClick:()=>e.back(),className:"flex-1 px-4 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition-colors",children:"ยกเลิก"}),s.jsx("button",{type:"submit",disabled:u,className:"flex-1 bg-slate-900 text-amber-400 px-4 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:u?s.jsx(s.Fragment,{children:"กำลังบันทึก..."}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(m.Z,{size:20})," บันทึกการเปลี่ยนแปลง"]})})]})]})]})})}),s.jsx(n.Z,{})]})}},8987:(e,t,a)=>{"use strict";a.d(t,{Z:()=>l});var s=a(5344),r=a(6506);function l(){return s.jsx("footer",{className:"hidden md:block bg-slate-900 text-slate-400 py-12 border-t-8 border-amber-400",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-4 text-center flex flex-col md:flex-row justify-between items-center gap-4",children:[s.jsx("p",{children:"\xa9 2024 Prasobpai. All wrongs reserved."}),(0,s.jsxs)("div",{className:"flex flex-wrap justify-center gap-6 text-sm font-medium",children:[s.jsx(r.default,{href:"/about",className:"hover:text-amber-400 transition-colors",children:"เกี่ยวกับเรา"}),s.jsx(r.default,{href:"/",className:"hover:text-amber-400 transition-colors",children:"รวมเรื่องซวยรายวัน"}),s.jsx(r.default,{href:"/",className:"hover:text-amber-400 transition-colors",children:"บทความแนะนำ"}),s.jsx(r.default,{href:"/privacy",className:"hover:text-amber-400 transition-colors",children:"นโยบายความเป็นส่วนตัว"})]})]})})}},2803:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>l,__esModule:()=>r,default:()=>o});let s=(0,a(6843).createProxy)(String.raw`C:\Users\ณวิธบุญยะรัตน์\Desktop\Next.js\4.Prasobpai\app\profile\edit\page.js`),{__esModule:r,$$typeof:l}=s,o=s.default},5421:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});let s=(0,a(4285).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[638,901,727,567,154],()=>a(1824));module.exports=s})();