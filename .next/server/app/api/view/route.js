"use strict";(()=>{var e={};e.id=579,e.ids=[579],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},3483:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>v,routeModule:()=>h,serverHooks:()=>_,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>f});var o={};t.r(o),t.d(o,{POST:()=>l});var s=t(5419),a=t(9108),i=t(9678),n=t(7493),u=t(8070),d=t(6113),p=t.n(d);let c=(0,n.eI)("https://dpkktxiiavunivqvkdol.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"sb_publishable_IP-OB42MoH1AMIhVS8wX-Q_Sr6btW_1");async function l(e){try{let{story_id:r}=await e.json();if(!r)return u.Z.json({error:"Story ID is required"},{status:400});let t=e.headers.get("x-forwarded-for")||"127.0.0.1";t.includes(",")&&(t=t.split(",")[0]);let o=p().createHash("md5").update(t).digest("hex"),s=new Date(Date.now()-864e5).toISOString(),{data:a,error:i}=await c.from("story_views").select("id").eq("story_id",r).eq("ip_hash",o).gte("viewed_at",s).limit(1);if(i&&console.error("Check Error:",i),a&&a.length>0)return u.Z.json({message:"View already counted in 24h"},{status:200});let{error:n}=await c.from("story_views").insert({story_id:r,ip_hash:o});if(n)return console.error("Insert Error:",n),u.Z.json({error:"Failed to record view"},{status:500});let{error:d}=await c.rpc("increment_view_count",{story_id:r});return d&&console.error("Increment Error:",d),u.Z.json({message:"View counted successfully"},{status:200})}catch(e){return console.error("API Error:",e),u.Z.json({error:"Internal Server Error"},{status:500})}}let h=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/view/route",pathname:"/api/view",filename:"route",bundlePath:"app/api/view/route"},resolvedPagePath:"C:\\Users\\ณวิธบุญยะรัตน์\\Desktop\\Next.js\\4.Prasobpai\\app\\api\\view\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:w,serverHooks:_,headerHooks:m,staticGenerationBailout:f}=h,g="/api/view/route";function y(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:w})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[638,206,493],()=>t(3483));module.exports=o})();