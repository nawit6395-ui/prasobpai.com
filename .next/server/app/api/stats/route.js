"use strict";(()=>{var e={};e.id=961,e.ids=[961],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},4679:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>S,patchFetch:()=>f,requestAsyncStorage:()=>v,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>_,staticGenerationBailout:()=>x});var s={};r.r(s),r.d(s,{GET:()=>c});var a=r(5419),i=r(9108),o=r(9678),n=r(7493),u=r(8070),l=r(6113),p=r.n(l);let d=(0,n.eI)("https://dpkktxiiavunivqvkdol.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY||"sb_publishable_IP-OB42MoH1AMIhVS8wX-Q_Sr6btW_1");async function c(e){try{let t=e.headers.get("x-forwarded-for")||"127.0.0.1";t.includes(",")&&(t=t.split(",")[0]);let r=p().createHash("md5").update(t).digest("hex"),s=new Date;s.setHours(0,0,0,0);let a=s.toISOString(),{data:i}=await d.from("site_visits").select("id").eq("ip_hash",r).gte("visited_at",a).limit(1);i&&0!==i.length||await d.from("site_visits").insert({ip_hash:r});let{count:o,error:n}=await d.from("site_visits").select("id",{count:"exact",head:!0}).gte("visited_at",a),{data:l,error:c}=await d.from("stories").select("severity_level"),h=0,v="ปกติ";l&&l.length>0&&(h=(l.reduce((e,t)=>e+(t.severity_level||0),0)/l.length).toFixed(1));let _=parseFloat(h);return v=_>8?"วิกฤต":_>5?"ปานกลาง":_>2?"เล็กน้อย":"สดใส",u.Z.json({dailyVisitors:o||0,avgSeverity:h,severityLabel:v})}catch(e){return console.error("Stats API Error:",e),u.Z.json({error:"Internal Server Error"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/stats/route",pathname:"/api/stats",filename:"route",bundlePath:"app/api/stats/route"},resolvedPagePath:"C:\\Users\\ณวิธบุญยะรัตน์\\Desktop\\Next.js\\4.Prasobpai\\app\\api\\stats\\route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:_,serverHooks:g,headerHooks:m,staticGenerationBailout:x}=h,S="/api/stats/route";function f(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:_})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,206,493],()=>r(4679));module.exports=s})();