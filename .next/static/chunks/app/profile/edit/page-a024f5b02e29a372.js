(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[159],{9371:function(e,t,a){Promise.resolve().then(a.bind(a,2577))},2577:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(3827),r=a(4090),l=a(7907),n=a(6943),i=a(473),o=a(9859),d=a(3411),c=a.n(d),u=a(3688),x=a(20);let f=(0,x.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),m=(0,x.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var h=a(4848);function p(){let e=(0,l.useRouter)(),[t,a]=(0,r.useState)(!0),[d,x]=(0,r.useState)(!1),[p,b]=(0,r.useState)(null),[v,g]=(0,r.useState)(""),[j,y]=(0,r.useState)(""),[w,N]=(0,r.useState)(""),[k,_]=(0,r.useState)(""),[Z,S]=(0,r.useState)(!1),[z,M]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{var t,s,r,l;let{data:{user:a}}=await n.supabase.auth.getUser();if(!a){e.push("/login");return}b(a);let{data:i,error:o}=await n.supabase.from("profiles").select("*").eq("id",a.id).single();o&&"PGRST116"!==o.code&&console.error("Error fetching profile:",o),i?(g(i.display_name||(null===(t=a.user_metadata)||void 0===t?void 0:t.username)||""),y(i.avatar_url||(null===(s=a.user_metadata)||void 0===s?void 0:s.avatar_url)||"")):(g((null===(r=a.user_metadata)||void 0===r?void 0:r.username)||""),y((null===(l=a.user_metadata)||void 0===l?void 0:l.avatar_url)||""))}catch(e){console.error("Error:",e)}finally{a(!1)}})()},[e]);let E=async e=>{try{if(S(!0),!e.target.files||0===e.target.files.length)throw Error("กรุณาเลือกไฟล์ภาพที่ต้องการอัปโหลด");let t=e.target.files[0],a=t.name.split(".").pop(),s="".concat(Math.random(),".").concat(a),r="".concat(p.id,"/").concat(s),{error:l}=await n.supabase.storage.from("avatars").upload(r,t);if(l)throw l;let{data:i}=n.supabase.storage.from("avatars").getPublicUrl(r);y(i.publicUrl)}catch(e){c().fire("อัปโหลดไม่สำเร็จ",e.message,"error")}finally{S(!1)}},P=async t=>{t.preventDefault(),x(!0);try{let t={id:p.id,display_name:v,avatar_url:j,updated_at:new Date},{error:a}=await n.supabase.from("profiles").upsert(t);if(a)throw a;if(await n.supabase.auth.updateUser({data:{username:v,avatar_url:j}}),w){if(w!==k)throw Error("รหัสผ่านไม่ตรงกัน");if(w.length<6)throw Error("รหัสผ่านต้องมีความยาวอย่างน้อย 6 ตัวอักษร");let{error:e}=await n.supabase.auth.updateUser({password:w});if(e)throw e}await c().fire({title:"บันทึกสำเร็จ!",text:"ข้อมูลโปรไฟล์ได้รับการอัปเดตแล้ว",icon:"success",confirmButtonText:"ตกลง",confirmButtonColor:"#0f172a"}),N(""),_(""),M(!1),e.refresh()}catch(e){console.error("Error updating profile:",e),c().fire({title:"บันทึกไม่สำเร็จ",text:"เกิดข้อผิดพลาด กรุณาลองใหม่",icon:"error",confirmButtonText:"ตกลง"})}finally{x(!1)}};return t?(0,s.jsx)("div",{className:"min-h-screen bg-[#fffbf0] flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-900"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-[#fffbf0] font-sans selection:bg-amber-200 selection:text-slate-900 flex flex-col",children:[(0,s.jsx)(i.default,{}),(0,s.jsx)("main",{className:"flex-grow pt-24 pb-12 px-4",children:(0,s.jsx)("div",{className:"max-w-xl mx-auto",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl border-4 border-slate-900 shadow-[8px_8px_0px_0px_rgba(251,191,36,1)] p-6 md:p-8",children:[(0,s.jsxs)("h1",{className:"text-2xl font-black text-slate-900 mb-6 flex items-center gap-2",children:[(0,s.jsx)(u.Z,{className:"text-amber-500",size:32})," แก้ไขข้อมูลส่วนตัว"]}),(0,s.jsxs)("form",{onSubmit:P,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"w-32 h-32 rounded-full border-4 border-slate-900 overflow-hidden bg-slate-100",children:(0,s.jsx)("img",{src:j||"https://api.dicebear.com/7.x/avataaars/svg?seed=default",alt:"Avatar",className:"w-full h-full object-cover"})}),(0,s.jsx)("label",{htmlFor:"avatar-upload",className:"absolute bottom-0 right-0 bg-slate-900 text-white p-2 rounded-full hover:bg-amber-500 transition-colors shadow-lg cursor-pointer",title:"อัปโหลดรูปภาพ",children:(0,s.jsx)(f,{size:16})}),(0,s.jsx)("input",{type:"file",id:"avatar-upload",accept:"image/*",onChange:E,className:"hidden",disabled:Z})]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsxs)("button",{type:"button",onClick:()=>{let e=Math.random().toString(36).substring(7);y("https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e))},className:"text-xs font-bold text-slate-500 hover:text-amber-600 flex items-center gap-1 bg-slate-100 px-3 py-1.5 rounded-full",children:[(0,s.jsx)(m,{size:12})," สุ่มรูปการ์ตูน"]})}),Z&&(0,s.jsx)("p",{className:"text-xs text-amber-500 font-bold animate-pulse",children:"กำลังอัปโหลด..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-2",children:"ชื่อที่ใช้แสดง (Display Name)"}),(0,s.jsx)("input",{type:"text",value:v,onChange:e=>g(e.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-slate-900 focus:outline-none bg-slate-50 font-medium",placeholder:"ใส่ชื่อเท่ๆ ของคุณ",maxLength:20,required:!0}),(0,s.jsxs)("p",{className:"text-xs text-slate-400 mt-1 text-right",children:[v.length,"/20"]})]}),(0,s.jsxs)("div",{className:"bg-slate-50 p-4 rounded-xl border border-slate-200",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>M(!z),className:"flex items-center justify-between w-full text-sm font-bold text-slate-700",children:[(0,s.jsx)("span",{children:"เปลี่ยนรหัสผ่าน"}),(0,s.jsx)("span",{className:"text-xl transition-transform ".concat(z?"rotate-45":""),children:"+"})]}),z&&(0,s.jsxs)("div",{className:"mt-4 space-y-3 animate-slide-down",children:[(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"password",value:w,onChange:e=>N(e.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-slate-900 focus:outline-none bg-white font-medium",placeholder:"รหัสผ่านใหม่",minLength:6})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"password",value:k,onChange:e=>_(e.target.value),className:"w-full px-4 py-3 rounded-lg border-2 border-slate-200 focus:border-slate-900 focus:outline-none bg-white font-medium",placeholder:"ยืนยันรหัสผ่านใหม่",minLength:6})}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"ปล่อยว่างไว้หากไม่ต้องการเปลี่ยนรหัสผ่าน"})]})]}),(0,s.jsx)("hr",{className:"border-slate-100"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>e.back(),className:"flex-1 px-4 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition-colors",children:"ยกเลิก"}),(0,s.jsx)("button",{type:"submit",disabled:d,className:"flex-1 bg-slate-900 text-amber-400 px-4 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:d?(0,s.jsx)(s.Fragment,{children:"กำลังบันทึก..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Z,{size:20})," บันทึกการเปลี่ยนแปลง"]})})]})]})]})})}),(0,s.jsx)(o.Z,{})]})}},9859:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var s=a(3827),r=a(8792);function l(){return(0,s.jsx)("footer",{className:"hidden md:block bg-slate-900 text-slate-400 py-12 border-t-8 border-amber-400",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-4 text-center flex flex-col md:flex-row justify-between items-center gap-4",children:[(0,s.jsx)("p",{children:"\xa9 2024 Prasobpai. All wrongs reserved."}),(0,s.jsxs)("div",{className:"flex flex-wrap justify-center gap-6 text-sm font-medium",children:[(0,s.jsx)(r.default,{href:"/about",className:"hover:text-amber-400 transition-colors",children:"เกี่ยวกับเรา"}),(0,s.jsx)(r.default,{href:"/",className:"hover:text-amber-400 transition-colors",children:"รวมเรื่องซวยรายวัน"}),(0,s.jsx)(r.default,{href:"/",className:"hover:text-amber-400 transition-colors",children:"บทความแนะนำ"}),(0,s.jsx)(r.default,{href:"/privacy",className:"hover:text-amber-400 transition-colors",children:"นโยบายความเป็นส่วนตัว"})]})]})})}},473:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(3827),r=a(4090),l=a(8792),n=a(7907),i=a(6943),o=a(9628),d=a(3688),c=a(6942),u=a(8198),x=a(4116),f=a(2677),m=a(1705);function h(){var e,t,a;let[h,p]=(0,r.useState)(!0),[b,v]=(0,r.useState)(0),[g,j]=(0,r.useState)(null),y=(0,n.usePathname)();(0,r.useEffect)(()=>{i.supabase.auth.getSession().then(e=>{var t;let{data:{session:a}}=e;j(null!==(t=null==a?void 0:a.user)&&void 0!==t?t:null)});let{data:{subscription:e}}=i.supabase.auth.onAuthStateChange((e,t)=>{var a;j(null!==(a=null==t?void 0:t.user)&&void 0!==a?a:null)});return()=>e.unsubscribe()},[]);let w=async()=>{await i.supabase.auth.signOut(),window.location.href="/login"};return(0,r.useEffect)(()=>{let e=()=>{let e=window.scrollY;e>b&&e>50?p(!1):p(!0),v(e)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[b]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("nav",{className:"hidden md:block sticky top-0 z-50 bg-slate-900 text-white shadow-lg border-b-4 border-amber-400",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto px-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)(l.default,{href:"/",className:"flex items-center space-x-2 cursor-pointer transform hover:-rotate-2 transition-transform",children:[(0,s.jsx)("div",{className:"bg-amber-400 text-slate-900 p-2 rounded-lg font-black text-xl border-2 border-white",children:"PRASOBPAI"}),(0,s.jsx)("span",{className:"font-bold text-lg text-amber-100",children:"ประสบภัย.คอม"})]}),(0,s.jsxs)("div",{className:"flex space-x-6 items-center",children:[(0,s.jsx)(l.default,{href:"/",className:"hover:text-amber-400 font-medium ".concat("/"===y?"text-amber-400 underline decoration-wavy underline-offset-4":""),children:"ศูนย์บรรเทาทุกข์"}),(0,s.jsx)(l.default,{href:"/submit",className:"hover:text-amber-400 font-medium ".concat("/submit"===y?"text-amber-400 underline decoration-wavy underline-offset-4":""),children:"แจ้งเหตุฉุกเฉิน"}),(0,s.jsx)(l.default,{href:"/about",className:"hover:text-amber-400 font-medium ".concat("/about"===y?"text-amber-400 underline decoration-wavy underline-offset-4":""),children:"เกี่ยวกับเรา"}),g?(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)(l.default,{href:"/profile/edit",className:"flex items-center gap-2 hover:text-amber-400",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-700 border border-white flex items-center justify-center overflow-hidden",children:(0,s.jsx)("img",{src:(null===(e=g.user_metadata)||void 0===e?void 0:e.avatar_url)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(g.email),alt:"Profile"})}),(0,s.jsx)("span",{className:"text-sm font-medium",children:(null===(t=g.user_metadata)||void 0===t?void 0:t.username)||"User"})]}),(0,s.jsx)("button",{onClick:w,className:"text-red-400 hover:text-red-300",title:"Logout",children:(0,s.jsx)(o.Z,{size:20})})]}):(0,s.jsx)(l.default,{href:"/login",className:"bg-white text-slate-900 px-4 py-2 rounded-lg font-bold hover:bg-amber-400 transition-colors",children:"เข้าสู่ระบบ"})]})]})})}),(0,s.jsxs)("div",{className:"md:hidden fixed top-0 left-0 right-0 z-50 transition-transform duration-300 ".concat(h?"translate-y-0":"-translate-y-full"),children:[(0,s.jsxs)("div",{className:"bg-slate-900 text-white px-4 py-3 flex justify-between items-center shadow-md",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:g?(0,s.jsx)(l.default,{href:"/profile/edit",children:(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-700 border border-slate-500 flex items-center justify-center overflow-hidden",children:(0,s.jsx)("img",{src:(null===(a=g.user_metadata)||void 0===a?void 0:a.avatar_url)||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(g.email),alt:"Profile"})})}):(0,s.jsx)(l.default,{href:"/login",children:(0,s.jsx)(d.Z,{className:"text-amber-400"})})}),(0,s.jsx)("div",{className:"font-black text-lg text-amber-400 tracking-wide",children:"PRASOBPAI"}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsx)(c.Z,{size:22,className:"text-white"})})]}),(0,s.jsx)("div",{className:"bg-slate-800 text-slate-300 px-2 py-2 overflow-x-auto no-scrollbar flex items-center gap-6 shadow-lg",children:["ภาพรวม","ประสบการณ์","เกร็ดความรู้","แลกเครดิตความซวย","ร้านค้าแก้เคล็ด"].map((e,t)=>(0,s.jsx)("span",{className:"whitespace-nowrap text-sm font-medium px-2 pb-1 border-b-2 ".concat(0===t?"text-amber-400 border-amber-400":"border-transparent"),children:e},t))})]}),(0,s.jsxs)("div",{className:"md:hidden fixed bottom-0 left-0 right-0 z-50 bg-white border-t border-slate-200 px-4 py-2 flex justify-between items-end shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] pb-safe",children:[(0,s.jsxs)(l.default,{href:"/",className:"flex flex-col items-center gap-1 w-1/5 ".concat("/"===y?"text-slate-900":"text-slate-400"),children:[(0,s.jsx)(u.Z,{size:24,strokeWidth:"/"===y?3:2}),(0,s.jsx)("span",{className:"text-[10px] font-bold",children:"หน้าแรก"})]}),(0,s.jsxs)("button",{className:"flex flex-col items-center gap-1 w-1/5 text-slate-400 hover:text-slate-900",children:[(0,s.jsx)(x.Z,{size:24}),(0,s.jsx)("span",{className:"text-[10px] font-bold",children:"บอร์ด"})]}),(0,s.jsxs)("div",{className:"relative w-1/5 flex justify-center",children:[(0,s.jsx)(l.default,{href:"/submit",className:"absolute -top-8 bg-slate-900 text-amber-400 p-4 rounded-full shadow-lg border-4 border-white transform hover:scale-105 transition-transform",children:(0,s.jsx)(f.Z,{size:28,strokeWidth:3})}),(0,s.jsx)("span",{className:"text-[10px] font-bold mt-8 text-slate-900",children:"โพสต์"})]}),(0,s.jsxs)("button",{className:"flex flex-col items-center gap-1 w-1/5 text-slate-400 hover:text-slate-900",children:[(0,s.jsx)(m.Z,{size:24}),(0,s.jsx)("span",{className:"text-[10px] font-bold",children:"แจ้งเตือน"})]}),(0,s.jsxs)(l.default,{href:"/profile/edit",className:"flex flex-col items-center gap-1 w-1/5 ".concat("/profile/edit"===y?"text-slate-900":"text-slate-400"),children:[(0,s.jsx)(d.Z,{size:24,strokeWidth:"/profile/edit"===y?3:2}),(0,s.jsx)("span",{className:"text-[10px] font-bold",children:"ฉัน"})]})]})]})}},6943:function(e,t,a){"use strict";a.r(t),a.d(t,{supabase:function(){return n}});var s=a(2066);let r="https://dpkktxiiavunivqvkdol.supabase.co",l="sb_publishable_IP-OB42MoH1AMIhVS8wX-Q_Sr6btW_1";if(!r||!l)throw Error("Missing Supabase Environment Variables");let n=(0,s.eI)(r,l)},7907:function(e,t,a){"use strict";var s=a(5313);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},1705:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(20).Z)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]])},4116:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(20).Z)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},8198:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(20).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},9628:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(20).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},2677:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(20).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},4848:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(20).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},6942:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(20).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},3688:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(20).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])}},function(e){e.O(0,[461,66,862,971,69,744],function(){return e(e.s=9371)}),_N_E=e.O()}]);