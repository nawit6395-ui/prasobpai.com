(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[416],{2414:function(e,t,s){Promise.resolve().then(s.bind(s,1550))},1550:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var r=s(3827),n=s(4090),l=s(7907),a=s(473),i=s(9859),o=s(3354);let c=(0,s(20).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);var d=s(4848),u=s(6943),f=s(3411),x=s.n(f),m=s(8792),b=s(8013),h=s(278);function p(e){let{params:t}=e,s=(0,l.useRouter)(),{id:f}=t,[p,y]=(0,n.useState)(!0),[g,v]=(0,n.useState)(!1),[j,w]=(0,n.useState)({title:"",category:"มรสุมชีวิต",severity:5,content:""}),[N,k]=(0,n.useState)(null),_={crisis:"มรสุมชีวิต",daily:"ภัยรายวัน",funny:"ขำแห้ง",guide:"คู่มือรอด"},Z={มรสุมชีวิต:"crisis",ภัยรายวัน:"daily",ขำแห้ง:"funny",คู่มือรอด:"guide"};(0,n.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await u.supabase.auth.getUser();if(!e){s.push("/login");return}k(e.id);let{data:t,error:r}=await u.supabase.from("stories").select("*").eq("id",f).single();if(r)throw r;let{data:n}=await u.supabase.from("profiles").select("role").eq("id",e.id).single(),l=t.user_id===e.id,a=(null==n?void 0:n.role)==="admin";if(!l&&!a){x().fire("Error","คุณไม่มีสิทธิ์แก้ไขโพสต์นี้","error"),s.push("/");return}w({title:t.title,category:_[t.category]||"มรสุมชีวิต",severity:t.severity_level,content:t.content})}catch(e){console.error("Error fetching story:",e),x().fire("Error","ไม่พบโพสต์ที่ต้องการแก้ไข","error"),s.push("/")}finally{y(!1)}})()},[f,s]);let C=e=>{let{name:t,value:s}=e.target;w(e=>({...e,[t]:s}))},E=async e=>{e.preventDefault(),v(!0);let t=Z[j.category];try{let{error:e}=await u.supabase.from("stories").update({title:j.title,category:t,severity_level:parseInt(j.severity),content:j.content}).eq("id",f);if(e)throw e;await x().fire({title:"บันทึกสำเร็จ!",text:"แก้ไขเรื่องราวเรียบร้อยแล้ว",icon:"success",confirmButtonText:"ตกลง",confirmButtonColor:"#0f172a"}),s.push("/"),s.refresh()}catch(e){console.error("Error updating story:",e),x().fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error",confirmButtonText:"ตกลง",confirmButtonColor:"#ef4444"})}finally{v(!1)}};return p?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#fffbf0]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-900"})}):(0,r.jsxs)("div",{className:"min-h-screen bg-[#fffbf0] font-sans selection:bg-amber-200 selection:text-slate-900",children:[(0,r.jsx)(a.default,{}),(0,r.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8 md:py-12 mt-20 md:mt-0 pb-24 md:pb-0",children:[(0,r.jsxs)(m.default,{href:"/",className:"inline-flex items-center gap-2 text-slate-500 hover:text-slate-900 font-bold mb-4",children:[(0,r.jsx)(o.Z,{size:20})," กลับหน้าแรก"]}),(0,r.jsxs)("div",{className:"bg-white p-6 md:p-8 rounded-xl border-4 border-slate-900 shadow-[4px_4px_0px_0px_rgba(251,191,36,1)] relative",children:[(0,r.jsxs)("h2",{className:"text-2xl font-black text-slate-900 mb-2 flex items-center gap-2",children:[(0,r.jsx)(c,{className:"text-amber-500"})," แก้ไขเรื่องราว"]}),(0,r.jsxs)("form",{className:"space-y-4 mt-6",onSubmit:E,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"หัวข้อเรื่อง"}),(0,r.jsx)("input",{type:"text",name:"title",value:j.title,onChange:C,className:"w-full p-3 border-2 border-slate-300 rounded-lg focus:border-slate-900 focus:outline-none bg-slate-50 text-sm",required:!0})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"หมวดหมู่"}),(0,r.jsxs)("select",{name:"category",value:j.category,onChange:C,className:"w-full p-3 border-2 border-slate-300 rounded-lg focus:border-slate-900 focus:outline-none bg-slate-50 text-sm",children:[(0,r.jsx)("option",{children:"มรสุมชีวิต"}),(0,r.jsx)("option",{children:"ภัยรายวัน"}),(0,r.jsx)("option",{children:"ขำแห้ง"}),(0,r.jsx)("option",{children:"คู่มือรอด"})]})]}),(0,r.jsx)("div",{children:(0,r.jsx)(b.Z,{value:j.severity,onChange:C})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"เล่าเหตุการณ์"}),(0,r.jsx)(h.Z,{content:j.content,onChange:e=>w(t=>({...t,content:e})),userId:N})]}),(0,r.jsx)("button",{type:"submit",disabled:g,className:"w-full bg-slate-900 text-amber-400 font-bold py-3 rounded-lg border-2 border-transparent hover:border-amber-400 shadow-lg transform active:scale-95 transition-transform disabled:opacity-50 flex justify-center items-center gap-2",children:g?"กำลังบันทึก...":(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{size:20})," บันทึกการแก้ไข"]})})]})]})]}),(0,r.jsx)(i.Z,{})]})}},3354:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(20).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},4848:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(20).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])}},function(e){e.O(0,[461,902,572,66,862,168,639,971,69,744],function(){return e(e.s=2414)}),_N_E=e.O()}]);