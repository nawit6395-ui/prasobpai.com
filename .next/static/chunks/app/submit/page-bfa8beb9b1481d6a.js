(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{7325:function(e,t,s){Promise.resolve().then(s.bind(s,1337))},1337:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var n=s(3827),r=s(3411),a=s.n(r),l=s(4090),o=s(7907),i=s(473),c=s(9859),d=s(3862),u=s(6943),f=s(8013),m=s(278);function x(){let e=(0,o.useRouter)(),[t,s]=(0,l.useState)(!1),[r,x]=(0,l.useState)(null),[b,h]=(0,l.useState)({title:"",category:"มรสุมชีวิต",severity:5,content:""}),p={มรสุมชีวิต:"crisis",ภัยรายวัน:"daily",ขำแห้ง:"funny",คู่มือรอด:"guide"};(0,l.useEffect)(()=>{(async()=>{let{data:{user:e}}=await u.supabase.auth.getUser();e&&x(e)})()},[]);let g=e=>{let{name:t,value:s}=e.target;h(e=>({...e,[t]:s}))},y=async t=>{t.preventDefault(),s(!0);let n=p[b.category];try{let{data:{user:t}}=await u.supabase.auth.getUser();if(!t){a().fire({title:"กรุณาเข้าสู่ระบบ",text:"ต้องเข้าสู่ระบบก่อนโพสต์เรื่องราว",icon:"warning",confirmButtonText:"ไปหน้าเข้าสู่ระบบ",confirmButtonColor:"#0f172a"}).then(t=>{t.isConfirmed&&e.push("/login")}),s(!1);return}let r=await fetch("/api/slugify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:b.title,category:n})}),{slug:l}=await r.json(),{error:o}=await u.supabase.from("stories").insert([{title:b.title,category:n,severity_level:parseInt(b.severity),content:b.content,user_id:t.id,slug:l||"story-".concat(Date.now())}]);if(o)throw o;await a().fire({title:"โพสต์สำเร็จ!",text:"เรื่องราวของคุณถูกแชร์เรียบร้อยแล้ว",icon:"success",confirmButtonText:"กลับหน้าแรก",confirmButtonColor:"#0f172a"}),e.push("/")}catch(e){console.error("Error adding story:",e),a().fire({title:"เกิดข้อผิดพลาด",text:e.message,icon:"error",confirmButtonText:"ตกลง",confirmButtonColor:"#ef4444"})}finally{s(!1)}};return(0,n.jsxs)("div",{className:"min-h-screen bg-[#fffbf0] font-sans selection:bg-amber-200 selection:text-slate-900",children:[(0,n.jsx)(i.default,{}),(0,n.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-8 md:py-12 mt-20 md:mt-0 pb-24 md:pb-0",children:(0,n.jsxs)("div",{className:"bg-white p-6 md:p-8 rounded-xl border-4 border-slate-900 shadow-[4px_4px_0px_0px_rgba(251,191,36,1)] relative",children:[(0,n.jsxs)("h2",{className:"text-2xl font-black text-slate-900 mb-2 flex items-center gap-2",children:[(0,n.jsx)(d.Z,{className:"text-red-500"})," เขียนเรื่องใหม่"]}),(0,n.jsxs)("form",{className:"space-y-6 mt-6",onSubmit:y,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"หัวข้อเรื่อง (ขอแบบพีคๆ)"}),(0,n.jsx)("input",{type:"text",name:"title",value:b.title,onChange:g,placeholder:"เช่น เดินตกท่อต่อหน้าคนที่แอบชอบ...",className:"w-full p-3 border-2 border-slate-300 rounded-lg focus:border-slate-900 focus:outline-none bg-slate-50 text-sm",required:!0})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"หมวดหมู่"}),(0,n.jsxs)("select",{name:"category",value:b.category,onChange:g,className:"w-full p-3 border-2 border-slate-300 rounded-lg focus:border-slate-900 focus:outline-none bg-slate-50 text-sm",children:[(0,n.jsx)("option",{children:"มรสุมชีวิต"}),(0,n.jsx)("option",{children:"ภัยรายวัน"}),(0,n.jsx)("option",{children:"ขำแห้ง"}),(0,n.jsx)("option",{children:"คู่มือรอด"})]})]}),(0,n.jsx)("div",{children:(0,n.jsx)(f.Z,{value:b.severity,onChange:g,name:"severity"})})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-bold text-slate-700 mb-1",children:"เล่าเหตุการณ์"}),(0,n.jsx)(m.Z,{content:b.content,onChange:e=>{h(t=>({...t,content:e}))},userId:null==r?void 0:r.id})]}),(0,n.jsx)("button",{type:"submit",disabled:t,className:"w-full bg-slate-900 text-amber-400 font-bold py-3 rounded-lg border-2 border-transparent hover:border-amber-400 shadow-lg transform active:scale-95 transition-transform disabled:opacity-50",children:t?"กำลังโพสต์...":"โพสต์เลย (เตือนภัยเพื่อนมนุษย์)"})]})]})}),(0,n.jsx)(c.Z,{})]})}},3862:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});let n=(0,s(20).Z)("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])}},function(e){e.O(0,[461,902,572,66,862,168,639,971,69,744],function(){return e(e.s=7325)}),_N_E=e.O()}]);